# Kavak Commercial Agent

## Prerequisites

- Python 3.8 or higher
- Docker and Docker Compose
- OpenAI API key account
- Jina AI API key account
- Twilio account

## Environment Setup

1. Clone the repository:
```bash
git clone [REPOSITORY_URL]
cd [DIRECTORY_NAME]
```

2. Configure environment files:
   - In each microservice, you'll find a `.env.sample` file
   - Copy the `.env.sample` to `.env` in each microservice:
```bash
# For example
cd microservices/Agent
cp .env.sample .env
```

3. Edit the `.env` files in each microservice with your credentials:
```env
# microservices/Agent/.env
OPENAI_API_KEY=your_openai_api_key
JINA_API_KEY=your_jina_api_key
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
```

## Installation

### Using Docker (Recommended)

1. Build and run the containers:
```bash
docker-compose up --build
```

## Project Structure

```
.
├── microservices/
│   └── Agent/
│       └── services/
│           └── agent_service.py
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
└── .env
```

## Usage

The service will be available at `http://localhost:3000` by default.

### Agent Microservice Endpoints

#### Agent Management
- `POST /agents`: Create a new agent
  ```json
  {
    "name": "Agent Name",
    "brand": "Kavak",
    "description": "Agent description",
    "tone": "Professional and friendly",
    "instructions": "Specific instructions"
  }
  ```
- `GET /agents/{agent_id}`: Get information about a specific agent
- `PUT /agents/{agent_id}`: Update agent configuration
- `DELETE /agents/{agent_id}`: Delete an agent

#### Chat and Messaging
- `POST /chat`: Start a conversation with the chatbot
  ```json
  {
    "agent_id": "agent_id",
    "conversation_id": "conversation_id",
    "message": "User message",
    "channel": "whatsapp"
  }
  ```
- `GET /chat/{conversation_id}`: Get conversation history
- `POST /chat/{conversation_id}/end`: End a conversation

#### Knowledge Base Management
- `POST /agents/{agent_id}/knowledge/file`: Upload training file
- `POST /agents/{agent_id}/knowledge/url`: Process URL for training
- `GET /agents/{agent_id}/knowledge`: Get knowledge base information

### Queue System

The system uses queues to handle asynchronous communications between microservices. The main queues are:

1. **Incoming Messages Queue**
   - Receives messages from different channels (WhatsApp)
   - Processes and distributes messages to corresponding agents
   - Handles automatic retries in case of failures

2. **Response Queue**
   - Manages responses generated by agents
   - Ensures message delivery to corresponding channels

#### Queue Configuration
Queues are automatically configured when starting services with Docker Compose. No additional configuration is required.

## Security and Best Practices

### Credential Management

1. **Never commit credentials to the repository**
   - Don't include API keys, tokens, or credentials in the code
   - Don't commit `.env` files to the repository
   - Always use `.env.sample` files as templates

2. **Sensitive Environment Variables**
   ```env
   # microservices/Agent/.env
   OPENAI_API_KEY=your_openai_api_key
   JINA_API_KEY=your_jina_api_key
   TWILIO_ACCOUNT_SID=your_twilio_account_sid
   TWILIO_AUTH_TOKEN=your_twilio_auth_token
   ```

3. **Best Practices**
   - Keep credentials in local `.env` files
   - Use different credentials for development and production
   - Rotate credentials periodically
   - Don't share credentials in messages or public documentation

### Repository Protection

1. **GitHub Security**
   - Repository has secret scanning enabled
   - Pushes containing credentials will be rejected
   - Review files before committing

2. **Files to Ignore**
   Make sure your `.gitignore` includes:
   ```
   # Environment files
   .env
   .env.*
   !.env.sample

   # Local configuration files
   config.local.json
   ```